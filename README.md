# CDCPSendProgram
README - CDCP 전송 프로그램 설명서

1. CD(양도가 가능한 정기 예금증서)로써, 3개월 단위로 만기가 정해지고 금리가 높아 단기투자 상품으로도 자주 이용되고 있다. 
2. CP(기업 어음) = 신용도가 높고 안정성이 높은 우량기업이 단기로 자금조달을 위해 발행하는 상품, 3개월 단위로 발행하는게 일반적이며
   우량기업들이 발행하는 어음이기 때문에, 확정금리도 높다고 함. 
이런 CD/CP를 종목들을 수신받고 분류하고 검증하여 EMAIL/FTP/SFTP를 이용하여 각 고객사에 전송하는 프로그램이다. 


1. 프로그램 흐름(위에서 아래순으로 설명)
 - 1) 4시30분부터 스케쥴러에 의해 프로그램 동작 수행
 - 2) 1분씩 타이머가 동작하면서 전송하는 고객사에 대해서 FLAG = 4(검증완료시간)가 되어 있는지 확인
 - 3) 검증완료시간 까지 DB에 기입 되어 있는지 확인 되면, 파일 생성 준비(DB에서 필요 값들을 추출)를 진행한다. 
 - 4) 각 고객사마다 HEAD/DATA/TAIL 여부에 따라서 파일생성 양식을 지정하여 파일을 생성한다. 
 - 5) 파일 생성이 완료 되면, 전송 유형(EMAIL/FTP/SFTP)에 따라서 파일 전송을 진행한다. 
 - 6) 전송이 완료되면, 파일링 또는 파일링+전송에 체크 여부에 따라서 전송기록로그 또는 신규추가사항에 기입을 진행하고 전송고객사 그리드에 해당 고객사 체크박스를 해제한다. 
 - 7) 혹시나 전송 이후에도 다시 검증을 진행하게 되는 고객사에 한하여 FLAG 값을 재확인하여 그리드에 있는 고객사 체크박스를 다시 체크해준다. 
 - 8) 1 ~ 7의 부분을 프로그램 동작된 이후로 종료 될때까지 계속 수행한다. 
 
 
 
2. 프로그램 흐름(함수 바탕으로 설명)
 - 1)readState() '전송 전 검수확인 및 재전송 진행
 - 2)readCustBank()'사무수탁사에 한해서, 분류코드생성까지 진행 되었다면 검수완료시간을 기입해줌. 
 - 3)FileSend() '파일 생성 준비 및 전송'
 - 4)custCodeSetQuery() '각 고객사별 쿼리코드를 이용하여 데이터 추출'
 - 5)MakeEmptyFileProcess() '4)에서 추출된 데이터가 없다면 빈파일 생성 진행'
 - 6)MakeFileProcess() '4)에서 추출된 데이터 존재시 파일 생성 진행'
 - 7)FileCreateOrAppend) '파일이름 및 빈 파일 생성'
 - 8)WriteHeadTail() '파일의 HEAD부분 기입 없으면 진행 X'
 - 9)LoadTail() '파일의 끝부분(TAIL) 데이터 세팅 없으면 진행 X'
 - 10)WriteData() '파일의 DATA 부분 데이터 파일에 기입 빈 파일 생성일 경우 진행 x' 
 - 11)WriteHeadTail() '파일의 TAIL 부분 파일에 기입'
 - 12)sendProcess() '전송 함수'
 - 13)sendFileNameSet() '전송 파일 이름 세팅'
 - 14)sendEmail() '이메일 전송'
 - 15)sendFTPVarSet() 'FTP 전송 '
 - 16)sendSFTPVarSet() 'SFTP 전송'
 - 17)insertLog() 'CDCP 전송프로그램 로그에 전송 관련 기입'
 - 18)Log_State() '신규추가사항 기입'
 - 19)readStateAuto() '기존 고객사가 검수를 다시 진행 할 경우 전송을 다시 진행하기 위해 FLAG 값 확인 후 전송고객사 그리드 체크박스를 체크해줌.'
 
 
3. 사용언어
 - VB.NET / Oracle DB
 
4. 기존 CDCP 전송프로그램과의 차이점
 - AS-IS : 국민은행증권수탁 오전 전송 <-> CDCP 전송프로그램 오후 전송이 분리됨. / TO-BE: 2개를 하나로 합침. 
 - AS-IS : 그룹이 존재 (그룹1/ 그룹2 등등)/ TO-BE : 그룹 불필요하므로 삭제
 - AS-IS : 전체리스트, 전송리스트가 그리드가 아니므로 어떤 고객사가 전송이 완료되면 해당 고객사를 삭제함. / TO-BE : 전체리스트, 전송리스트가 그리드로 변경, 어떤 고객사의 전송이 완료 되면 체크박스 해제
 - AS-IS : 전송기록 부분도 그리드가 아니므로 텍스트박스로만 작성됨/ TO-BE : 그리드로 변경(날짜 / 고객사코드/ 파일링전송여부 / 완료기록)
 - AS-IS : 전송 유형(EMAIL/FTP/SFTP) 중 EMAIL-FTP 전송 중에 EMAIL이 오류가 발생하면 추후 FTP 전송 X/ TO-BE : 전송 유형(EMAIL/FTP/SFTP) 중 EMAIL-FTP 전송 중에 EMAIL이 오류가 발생하면 FTP 부분 진행
 - AS-IS : 전송 중 SFTP 전송에서 (WINSCP 접속오류, 업로드 후 파일 유무, 알 수 없는 오류) 3가지 정도의 오류 기입만 존재/ TO-BE : 전송 유형에서 전송 오류가 발생 할 경우, 해당 부분에 대한 신규추가사항에 오류 기입 진행
 
 
